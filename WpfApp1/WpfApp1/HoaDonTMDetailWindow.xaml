<Window x:Class="WpfApp1.HoaDonTMDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Hóa đơn thương mại"
        Height="620" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        WindowStyle="SingleBorderWindow"
        Background="Transparent">

    <Window.Resources>
        <!-- Header gradient -->
        <LinearGradientBrush x:Key="HdTmHeaderGradientBrush" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#43A047" Offset="0"/>
            <GradientStop Color="#1E88E5" Offset="1"/>
        </LinearGradientBrush>
    </Window.Resources>

    <Border CornerRadius="12"
            BorderBrush="#D5DBDB"
            BorderThickness="1"
            Background="White"
            Padding="18"
            Margin="6"
            SnapsToDevicePixels="True">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20"
                              ShadowDepth="4"
                              Opacity="0.28"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- header -->
                <RowDefinition Height="*"/>
                <!-- form + grid -->
                <RowDefinition Height="Auto"/>
                <!-- buttons -->
            </Grid.RowDefinitions>

            <!-- HEADER BAR -->
            <Border Grid.Row="0"
                    Background="{StaticResource HdTmHeaderGradientBrush}"
                    CornerRadius="10"
                    Padding="14"
                    Margin="0,0,0,14">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🏢"
                               FontSize="22"
                               Margin="0,0,10,0"/>
                    <StackPanel>
                        <TextBlock x:Name="lblHeader"
                                   Text="Hóa đơn thương mại"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="White"/>
                        <TextBlock Text="Nhập / chỉnh sửa thông tin hóa đơn thương mại và chi tiết vật tư"
                                   FontSize="12"
                                   Foreground="#E8F5E9"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- FORM + CHI TIẾT (cho ScrollViewer phòng khi thu nhỏ cửa sổ) -->
            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto">
                <Grid Margin="4,0,4,8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- form trên -->
                        <RowDefinition Height="Auto"/>
                        <!-- groupbox -->
                    </Grid.RowDefinitions>

                    <!-- FORM TRÊN -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Hàng 0 -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="8,6">
                            <TextBlock Text="ID (tự tăng)" FontWeight="Bold"/>
                            <TextBox x:Name="txtId"
                                     Margin="0,6,0,0"
                                     IsReadOnly="True"
                                     Style="{StaticResource InputTextBox}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,6">
                            <TextBlock Text="Số tiền (bắt buộc)" FontWeight="Bold"/>
                            <TextBox x:Name="txtSoTien"
                                     Margin="0,6,0,0"
                                     Style="{StaticResource InputTextBox}"/>
                        </StackPanel>

                        <!-- Hàng 1 -->
                        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8,6">
                            <TextBlock Text="Hạn thanh toán (bắt buộc)" FontWeight="Bold"/>
                            <DatePicker x:Name="dpHanTT"
                                        Margin="0,6,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,6">
                            <TextBlock Text="Trạng thái (bắt buộc)" FontWeight="Bold"/>
                            <ComboBox x:Name="cbTrangThai"
                                      Margin="0,6,0,0"
                                      MinHeight="30">
                                <ComboBoxItem Content="ChuaThanhToan"/>
                                <ComboBoxItem Content="DaThanhToan"/>
                                <ComboBoxItem Content="QuaHan"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Hàng 2 -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Margin="8,6">
                            <TextBlock Text="Mặt bằng thương mại (bắt buộc)" FontWeight="Bold"/>
                            <ComboBox x:Name="cbMatBang"
                                      DisplayMemberPath="TenMatBang"
                                      SelectedValuePath="MatBangID"
                                      Margin="0,6,0,0"
                                      MinHeight="30"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Grid.Column="1" Margin="8,6">
                            <TextBlock Text="Ghi chú" FontWeight="Bold"/>
                            <TextBox x:Name="txtGhiChu"
                                     Margin="0,6,0,0"
                                     Style="{StaticResource InputTextBox}"/>
                        </StackPanel>
                    </Grid>

                    <!-- GROUPBOX CHI TIẾT VẬT TƯ -->
                    <GroupBox Grid.Row="1"
                              Header="Chi tiết vật tư"
                              Margin="4,4,4,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Nút thêm -->
                            <Button Content="➕ Thêm vật tư"
                                    Grid.Row="0"
                                    Width="140" Height="30"
                                    Margin="0,0,0,5"
                                    HorizontalAlignment="Right"
                                    Click="BtnThemVatTu_Click"/>

                            <!-- DataGrid -->
                            <DataGrid x:Name="dgChiTiet"
                                      Grid.Row="1"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True"
                                      HeadersVisibility="Column"
                                      AlternatingRowBackground="#F8F9F9"
                                      GridLinesVisibility="None"
                                      RowHeight="30"
                                      FontSize="13"
                                      BorderBrush="#D5DBDB"
                                      BorderThickness="1"
                                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                                      ScrollViewer.HorizontalScrollBarVisibility="Auto">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Vật tư"
                                                        Binding="{Binding TenVatTu}"
                                                        Width="*"/>
                                    <DataGridTextColumn Header="Số lượng"
                                                        Binding="{Binding SoLuong}"
                                                        Width="100"/>
                                    <DataGridTextColumn Header="Đơn giá"
                                                        Binding="{Binding DonGia, StringFormat={}{0:N0}}"
                                                        Width="120"/>
                                    <DataGridTextColumn Header="Thành tiền"
                                                        Binding="{Binding ThanhTien, StringFormat={}{0:N0}}"
                                                        Width="140"/>
                                    <DataGridTemplateColumn Header="Hành động"
                                                            Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="🗑 Xóa"
                                                        Background="#E74C3C"
                                                        Foreground="White"
                                                        Padding="5,2"
                                                        Click="BtnXoaVatTu_Click"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </GroupBox>

                </Grid>
            </ScrollViewer>

            <!-- BUTTONS -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,6,0,0">
                <Button x:Name="btnSave"
                        Content="Lưu"
                        Width="120" Height="36"
                        Style="{StaticResource ModernButton}"
                        Background="#58D68D"
                        Click="BtnSave_Click"/>
                <Button Content="Hủy"
                        Width="120" Height="36"
                        Margin="8,0,0,0"
                        Style="{StaticResource ModernButton}"
                        Background="#7D3C98"
                        Click="BtnClose_Click"/>
            </StackPanel>

        </Grid>
    </Border>
</Window>
